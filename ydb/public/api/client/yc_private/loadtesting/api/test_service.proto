syntax = "proto3";

package yandex.cloud.priv.loadtesting.api.v1;

option go_package = "a.yandex-team.ru/contrib/ydb/public/api/client/yc_private/loadtesting/api/v1;loadtesting";

import "google/api/annotations.proto";
import "yandex/cloud/priv/operation/operation.proto";
import "yandex/cloud/api/operation.proto";
import "yandex/cloud/priv/loadtesting/api/v1/test/single_agent_configuration.proto";
import "yandex/cloud/priv/loadtesting/api/v1/test/details.proto";
import "yandex/cloud/priv/loadtesting/api/v1/test/test.proto";

service TestService {
  rpc Create(CreateTestRequest) returns (operation.Operation) {
    option (google.api.http) = { post: "/loadtesting/api/v1/tests" body: "*" };
    option (yandex.cloud.api.operation) = {
      metadata: "CreateTestMetadata"
      response: "test.Test"
    };
  };
  rpc Get(GetTestRequest) returns (test.Test) {
    option (google.api.http) = { get: "/loadtesting/api/v1/tests/{test_id}"};
  }
  rpc Stop(StopTestRequest) returns (operation.Operation) {
    option (google.api.http) = { post: "/loadtesting/api/v1/tests/{test_id}:stop" body: "*"};
    option (yandex.cloud.api.operation) = {
      metadata: "StopTestMetadata"
      response: "test.Test"
    };
  }
  rpc Delete(DeleteTestRequest) returns (operation.Operation) {
    option (google.api.http) = { delete: "/loadtesting/api/v1/tests/{test_id}" };
    option (yandex.cloud.api.operation) = {
      metadata: "DeleteTestMetadata"
      response: "google.protobuf.Empty"
    };
  }
  rpc List(ListTestsRequest) returns (ListTestsResponse) {
    option (google.api.http) = { get: "/loadtesting/api/v1/tests/list" };
  }
}

message CreateTestRequest {
  string folder_id = 1;
  repeated test.SingleAgentConfiguration configurations = 2;
  test.Details test_details = 3;
}

message CreateTestMetadata {
  string test_id = 1;
}

message GetTestRequest {
  string test_id = 1;
}

message StopTestRequest {
  string test_id = 1;
}

message StopTestMetadata {
  string test_id = 1;
}

message DeleteTestRequest {
  string test_id = 1;
}

message DeleteTestMetadata {
  string test_id = 1;
}

message ListTestsRequest {
  string folder_id = 1;
  int64 page_size = 2;
  string page_token = 3;
  string filter = 4;
}

message ListTestsResponse {
  repeated test.Test tests = 1;
  string next_page_token = 2;
}
